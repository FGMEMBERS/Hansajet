<?xml version="1.0"?>

<PropertyList xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../../Docs/XMLSchema/autopilot.xsd">
  <!-- ========================================================================== -->
  <!-- Other filters, not related to the autopilot                                -->
  <!-- ========================================================================== -->

  <logic>
    <name>NAV0:LOC Frequency Detector</name>
    <input>
      <greater-than-equals>
        <property>/instrumentation/nav[0]/frequencies/selected-mhz</property>
        <value>108.0</value>
      </greater-than-equals>
      <less-than-equals>
        <property>/instrumentation/nav[0]/frequencies/selected-mhz</property>
        <value>111.9</value>
      </less-than-equals>
    </input>
    <output>/instrumentation/nav[0]/frequencies/is-loc-frequency</output>
  </logic>

  <logic>
    <name>NAV1:LOC Frequency Detector</name>
    <input>
      <greater-than-equals>
        <property>/instrumentation/nav[1]/frequencies/selected-mhz</property>
        <value>108.0</value>
      </greater-than-equals>
      <less-than-equals>
        <property>/instrumentation/nav[1]/frequencies/selected-mhz</property>
        <value>111.9</value>
      </less-than-equals>
    </input>
    <output>/instrumentation/nav[1]/frequencies/is-loc-frequency</output>
  </logic>

  <!-- ========================================================================== -->
  <!-- Provide a relative bearing property for the RMI -->
  <!-- ========================================================================== -->
  <pi-simple-controller>
    <name>OTHER:NAV1 relative bearing</name>
    <debug>false</debug>
    <input>
      <condition>
        <not>
          <property>instrumentation/collins-313n[0]/test-position</property>
        </not>
        <greater-than>
          <property>/instrumentation/nav[0]/signal-quality-norm</property>
          <value>0.2</value>
        </greater-than>
      </condition>
      <property>/orientation/heading-magnetic-deg</property>
    </input>
    <input>0</input>
    <reference>
      <condition>
        <equals>
          <property>instrumentation/collins-313n[0]/test-position</property>
          <value type="int">-1</value>
        </equals>
      </condition>
      <value>180.0</value>
    </reference>
    <reference>
      <condition>
        <greater-than>
          <property>/instrumentation/nav[0]/signal-quality-norm</property>
          <value>0.2</value>
        </greater-than>
      </condition>
      <property>/instrumentation/nav[0]/radials/reciprocal-radial-deg</property>
    </reference>
    <reference>90.0</reference>
    <output>/instrumentation/nav[0]/relative-bearing-deg</output>
    <Kp>1.0</Kp>
  </pi-simple-controller>

  <pi-simple-controller>
    <name>OTHER:NAV2 relative bearing</name>
    <debug>false</debug>
    <input>
      <condition>
        <not>
          <property>instrumentation/collins-313n[1]/test-position</property>
        </not>
        <greater-than>
          <property>/instrumentation/nav[1]/signal-quality-norm</property>
          <value>0.2</value>
        </greater-than>
      </condition>
      <property>/orientation/heading-magnetic-deg</property>
    </input>
    <input>0</input>
    <reference>
      <condition>
        <equals>
          <property>instrumentation/collins-313n[1]/test-position</property>
          <value type="int">-1</value>
        </equals>
      </condition>
      <value>180.0</value>
    </reference>
    <reference>
      <condition>
        <greater-than>
          <property>/instrumentation/nav[1]/signal-quality-norm</property>
          <value>0.2</value>
        </greater-than>
      </condition>
      <property>/instrumentation/nav[1]/radials/reciprocal-radial-deg</property>
    </reference>
    <reference>90.0</reference>
    <output>/instrumentation/nav[1]/relative-bearing-deg</output>
    <Kp>1.0</Kp>
  </pi-simple-controller>

  <!-- compute property for AOA indicator -->
  <filter>
    <name>OTHER:aoa-indexer</name>
    <debug>false</debug>
    <type>gain</type>
    <input>
      <property>/fdm/jsbsim/aero/alpha-deg</property>
      <scale>
        <!-- mach 0.05 gives full indication (approx 30kts) -->
        <property>/fdm/jsbsim/velocities/mach</property>
        <scale>-20</scale>
        <min>-1.0</min>
        <max>0.0</max>
      </scale>
      <offset>
        <!-- gravity forces the pickup down, airspeed up -->
        <!-- no speed: indicated aoa=-90 -->
        <property>/fdm/jsbsim/velocities/mach</property>
        <scale>-600</scale>
        <offset>30</offset>
        <min>0.0</min>
        <max>90.0</max>
      </offset>
    </input>
    <output>
      <property>/instrumentation/aoa-indexer/aoa-deg</property>
      <value>0.0</value>
    </output>
    <gain>-1.0</gain>
    <min>-90</min>
    <max>90</max>
  </filter>

  <!-- Compute Oil Temperature (JSBSim does not compute it) -->
  <!--
target-oil-temp = egt + (rho_air*ias*C+D)*(ambient-egt)
	-->
  <filter>
    <name>OTHER:Oil Temperature</name>
    <debug>false</debug>
    <type>gain</type>
    <input>
      <property>/environment/density-slugft3</property>
      <scale>
        <property>/instrumentation/airspeed-indicator/indicated-speed-kt</property>
        <scale>0.05</scale>
      </scale>
      <offset>0.73</offset>
    </input>
    <gain>1</gain>
    <output>/engines/cooling-factor</output>
  </filter>

  <filter>
    <name>OTHER:Oil Temperature 0</name>
    <debug>false</debug>
    <type>exponential</type>
    <input>
      <property>/engines/engine[0]/egt-degf</property>
      <offset>
        <property>/engines/cooling-factor</property>
        <scale>
          <property>/environment/temperature-degf</property>
          <offset>
            <property>/engines/engine[0]/egt-degf</property>
            <scale>-1.0</scale>
          </offset>
        </scale>
      </offset>
    </input>
    <output>/engines/engine[0]/oil-temperature-degf</output>
    <!-- engine running, filter time is 120
	engine off, filter time is 600 -->
    <filter-time>
      <property>/engines/engine[0]/running</property>
      <scale>-480</scale>
      <offset>600</offset>
    </filter-time>
  </filter>

  <filter>
    <name>OTHER:Oil Temperature 1</name>
    <debug>false</debug>
    <type>exponential</type>
    <input>
      <property>/engines/engine[1]/egt-degf</property>
      <offset>
        <property>/engines/cooling-factor</property>
        <scale>
          <property>/environment/temperature-degf</property>
          <offset>
            <property>/engines/engine[1]/egt-degf</property>
            <scale>-1.0</scale>
          </offset>
        </scale>
      </offset>
    </input>
    <output>/engines/engine[1]/oil-temperature-degf</output>
    <!-- behave a little different/faster than engine 0 -->
    <filter-time>
      <property>/engines/engine[1]/running</property>
      <scale>-400</scale>
      <offset>500</offset>
    </filter-time>
  </filter>
</PropertyList>
